<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Super Explaining Calculator â€” Steps & Animations</title>
<style>
  :root{
    --accent:#06b6d4; --muted:#94a3b8; --bg1:#071126; --bg2:#0b2540;
    --panel:#0f1724; --glass: rgba(255,255,255,0.03);
    font-family: Inter, "Segoe UI", Roboto, Arial, sans-serif;
  }
  *{box-sizing:border-box}
  body{margin:0; min-height:100vh; background:linear-gradient(180deg,var(--bg1),var(--bg2)); color:#e6eef7; padding:20px}
  .app{max-width:1150px;margin:0 auto;display:grid;grid-template-columns:440px 1fr;gap:18px;align-items:start}
  .controls{background:var(--panel);padding:14px;border-radius:12px;box-shadow:0 12px 40px rgba(0,0,0,0.6)}
  .row{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px}
  .switch-btn{padding:8px 12px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);cursor:pointer;font-weight:700}
  .switch-btn.active{background:linear-gradient(90deg,var(--accent),#0ea5a4);color:#001522;border:none;box-shadow:0 8px 25px rgba(14,165,164,0.12)}
  .calc-wrap{display:flex;gap:12px}
  .calculator{width:420px;border-radius:12px;padding:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));box-shadow:0 10px 30px rgba(0,0,0,0.5)}
  .calculator.realistic{background:linear-gradient(180deg,#e6eef7,#cfe8ff);color:#071022}
  .display{border-radius:10px;padding:10px;min-height:74px;display:flex;flex-direction:column;justify-content:center;text-align:right;gap:6px;overflow:hidden}
  .expr{font-size:13px;color:var(--muted);opacity:0.95;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .val{font-size:22px;font-weight:800}
  .keys{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-top:12px}
  button.key{background:#0f1724;color:#e6eef7;padding:12px;border-radius:10px;border:none;font-weight:700;cursor:pointer}
  .calculator.realistic button.key{background:#e6eef7;color:#071022;box-shadow:inset 0 -4px 0 rgba(0,0,0,0.06)}
  button.fn{background:#334155}
  .calculator.realistic button.fn{background:#fbbf24;color:#071022}
  button.equal{background:linear-gradient(90deg,#06b6d4,#0ea5a4);color:#001522;grid-row:span 2;display:flex;align-items:center;justify-content:center}
  .wide{grid-column: span 2}
  .small{padding:8px;font-size:13px}
  .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:12px;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,0.45)}
  .panel h3{margin:6px 0 10px}
  .history{max-height:160px;overflow:auto;padding:8px;border-radius:8px;background:rgba(255,255,255,0.01)}
  .hist-item{padding:8px;border-radius:8px;margin-bottom:8px;display:flex;justify-content:space-between;gap:8px;color:var(--muted);cursor:pointer}
  .explainBox{margin-top:12px;color:#cfeff0;font-size:15px}
  .steps{margin-top:12px;background:rgba(0,0,0,0.18);padding:10px;border-radius:10px;max-height:calc(100vh - 340px);overflow:auto}
  .step{padding:8px;border-radius:8px;margin-bottom:8px;background:rgba(255,255,255,0.02);color:var(--muted);transition:background .25s, transform .12s}
  .step.highlight{background:linear-gradient(90deg,#06b6d4,#0ea5a4);color:#001522;transform:scale(1.02)}
  .meta{margin-top:12px;color:var(--muted);font-size:13px}
  .controlsSmall{display:flex;gap:6px;justify-content:space-between;align-items:center}
  .compactToggle{margin-left:auto;padding:8px 10px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.06);cursor:pointer;color:var(--muted)}
  @media (max-width:980px){.app{grid-template-columns:1fr;padding:12px}.calculator{width:100%}}
</style>
</head>
<body>
  <div class="app">
    <div>
      <div class="controls">
        <h1 id="title">ðŸ§® Super Explaining Calculator â€” Steps</h1>
        <div class="row">
          <button id="langBtn" class="switch-btn">EN ðŸ‡¬ðŸ‡§</button>
          <button id="designBtn" class="switch-btn active">Realistic</button>
          <button id="themeBtn" class="switch-btn">Dark</button>
          <button id="compactBtn" class="compactToggle">Compact</button>
        </div>

        <div class="calc-wrap">
          <div id="calc" class="calculator realistic" role="application" aria-label="Calculator">
            <div id="display" class="display" aria-live="polite">
              <div class="expr" id="exprLine">&nbsp;</div>
              <div class="val" id="valueLine">0</div>
            </div>

            <div class="keys" id="keys">
              <button class="key fn small" data-action="mc">MC</button>
              <button class="key fn small" data-action="mr">MR</button>
              <button class="key fn small" data-action="mplus">M+</button>
              <button class="key fn small" data-action="mminus">M-</button>
              <button class="key small" data-insert="(">(</button>

              <button class="key" data-insert="7">7</button>
              <button class="key" data-insert="8">8</button>
              <button class="key" data-insert="9">9</button>
              <button class="key" data-insert="/" title="divide">Ã·</button>
              <button class="key fn" data-insert="Math.sqrt(" title="sqrt">âˆš</button>

              <button class="key" data-insert="4">4</button>
              <button class="key" data-insert="5">5</button>
              <button class="key" data-insert="6">6</button>
              <button class="key" data-insert="*" title="multiply">Ã—</button>
              <button class="key fn" data-insert="**" title="power">^</button>

              <button class="key" data-insert="1">1</button>
              <button class="key" data-insert="2">2</button>
              <button class="key" data-insert="3">3</button>
              <button class="key" data-insert="-" title="subtract">âˆ’</button>
              <button class="key fn" data-insert="Math.pow(" title="xÊ¸">xÊ¸</button>

              <button class="key wide" data-insert="0">0</button>
              <button class="key" data-insert=".">.</button>
              <button class="key" data-insert="+">+</button>
              <button class="key fn" data-insert="Math.sin(" title="sin">sin</button>
              <button class="key equal" id="equalBtn">=</button>

              <button class="key fn" data-insert="Math.cos(">cos</button>
              <button class="key fn" data-insert="Math.tan(">tan</button>
              <button class="key fn" data-insert="Math.log10(">log</button>
              <button class="key fn" data-insert="Math.log(">ln</button>
              <button class="key fn" data-insert="Math.PI">Ï€</button>

              <button class="key fn" data-insert="Math.E">e</button>
              <button class="key fn" data-action="sq">xÂ²</button>
              <button class="key fn" data-action="cube">xÂ³</button>
              <button class="key fn" data-action="percent">%</button>
              <button class="key" data-action="clear">AC</button>

              <button class="key" data-action="del">DEL</button>
              <button class="key" data-action="ans">ANS</button>
              <button class="key" data-action="history">HIST</button>
              <button class="key" data-action="explain">Explain</button>
              <button class="key" data-action="neg">+/-</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="rightcol">
      <div class="panel">
        <h3 id="histTitle">History</h3>
        <div class="history" id="historyList"></div>
        <div class="explainBox">
          <strong id="resLabel">Result:</strong>
          <div id="resExplain" style="margin-top:8px;color:#cfeff0">No calculation yet.</div>
        </div>
        <div class="meta" id="meta">Memory: 0 â€¢ Mode: Realistic â€¢ Language: English</div>
      </div>

      <div class="panel">
        <h3 id="stepsTitle">Working Steps</h3>
        <div class="steps" id="stepsBox">
          <div class="step">No steps yet. Enter expression and press =</div>
        </div>
      </div>
    </div>
  </div>

<script>
/* -----------------------
   Translations & State
   ----------------------- */
const translations = {
  en:{ title:"ðŸ§® Super Explaining Calculator â€” Steps", history:"History", stepsTitle:"Working Steps", resultLabel:"Result:", noCalc:"No calculation yet.", mem:"Memory", modeReal:"Realistic", modeDig:"Digital", themeDark:"Dark", themeLight:"Light", langShort:"EN ðŸ‡¬ðŸ‡§", speakPrefix:"Result", compact:"Compact", verbose:"Verbose"},
  lg:{ title:"ðŸ§® Kalikulata â€” Enzira z'Okukola", history:"Ebyabaddibwa", stepsTitle:"Enzira z'Okukola", resultLabel:"Ekyavaamu:", noCalc:"Tewali kunonyebwa.", mem:"Obubonero", modeReal:"Realistic", modeDig:"Digital", themeDark:"Ddwaniro", themeLight:"Enkazi", langShort:"LG ðŸ‡ºðŸ‡¬", speakPrefix:"Obubonero", compact:"Mupiira", verbose:"Gulu"}
};
let lang='en', design='realistic', theme='dark';
let expr='', lastAns=0, memory=0, history=[];
let compactMode=true; // default compact

/* Elements */
const exprLine=document.getElementById('exprLine'), valueLine=document.getElementById('valueLine');
const historyList=document.getElementById('historyList'), stepsBox=document.getElementById('stepsBox');
const resExplain=document.getElementById('resExplain'), resLabel=document.getElementById('resLabel');
const meta=document.getElementById('meta'), titleEl=document.getElementById('title');
const histTitle=document.getElementById('histTitle'), stepsTitle=document.getElementById('stepsTitle');
const compactBtn=document.getElementById('compactBtn');

/* -----------------------
   Safe evaluation helpers
   ----------------------- */
function replaceTokens(s){
  let t=String(s);
  t=t.replace(/Ã·/g,'/').replace(/Ã—/g,'*').replace(/âˆ’/g,'-');
  t=t.replace(/\bANS\b/gi, `(${lastAns})`);
  t=t.replace(/\^/g,'**');
  t=t.replace(/Ï€/g,'Math.PI');
  // don't replace standalone e inside words; use regex to replace e as standalone token
  t=t.replace(/(^|[^A-Za-z0-9_])e([^A-Za-z0-9_]|$)/g, '$1Math.E$2');
  return t;
}
function evaluateSafe(input){
  if(!input) return 0;
  const safe=replaceTokens(input);
  const fn=new Function('Math','Number', `"use strict"; return (${safe});`);
  const result=fn(Math,Number);
  if(typeof result==='number' && !isFinite(result)) throw new Error('Non-finite');
  return result;
}

/* -----------------------
   Step-generation (detailed)
   ----------------------- */
function generateSteps(original){
  const steps=[]; if(!original){ steps.push({text:translations[lang].noCalc}); return steps; }
  steps.push({text: compactMode ? `1) ${original}` : `1) Original expression: ${original}`});
  const replaced = replaceTokens(original);
  steps.push({text: compactMode ? `2) ${replaced}` : `2) Replace tokens (ANS, Ï€, e, ^): ${replaced}`});

  // Work on string that uses Math.* and ** etc.
  let working = replaced;
  let stepIndex = 3;

  const evalSegment = (seg)=>{
    try { return (new Function('Math','Number',`"use strict"; return (${seg});`))(Math,Number); }
    catch(e){ return null; }
  };

  // 1) Resolve parentheses iteratively, showing evaluation of innermost parentheses
  const maxLoops = 200; let loop=0;
  while(loop<maxLoops){
    loop++;
    const m = working.match(/\([^()]*\)/);
    if(m){
      const inner = m[0]; const content = inner.slice(1,-1);
      // For inner content we can further break into precedence steps:
      const innerSteps = breakdownOperations(content);
      // evaluate inner value:
      const val = evalSegment(content);
      const valStr = (val===null)? 'Error' : String(val);
      // push inner steps (prefixed with step numbers)
      innerSteps.forEach(it=> steps.push({text: `${stepIndex}) ${it}`}) , stepIndex++);
      // then show replacement
      steps.push({text: `${stepIndex}) Replace ${inner} â†’ ${valStr}`}); stepIndex++;
      working = working.replace(inner, valStr);
      continue;
    }
    break;
  }

  // 2) After parentheses resolved, break down remaining operations by precedence
  const remainingSteps = breakdownOperations(working);
  remainingSteps.forEach(s=> steps.push({text: `${stepIndex}) ${s}`}), stepIndex++);

  // 3) Final evaluation
  const finalVal = evalSegment(working);
  steps.push({text: `${stepIndex}) ${compactMode ? `${working} = ${finalVal}` : `Final evaluate ${working} equals ${finalVal}`}`});

  return steps;
}

/* Breakdown operations by precedence for an expression string WITHOUT parentheses.
   This is a heuristic approach:
   - Tokenize numbers (including decimal) and operators and Math.* tokens
   - Apply precedence: exponentiation (**), then multiplication/division (*,/), then addition/subtraction (+,-)
   At each operation we produce a step description.
*/
function breakdownOperations(exprStr){
  // if exprStr empty
  if(!exprStr) return [(lang==='en') ? 'Empty expression' : 'Ensonda teryo'];

  // Tokenize: capture Math.xxx(...) as single token, numbers, parentheses (shouldn't be here), operators
  // We'll protect function calls like Math.sin(2) by not breaking inside them; but after parentheses resolved we may still have Math.sqrt
  // Simpler: attempt to evaluate left-most operator of highest precedence by regex search and replace with evaluated value.
  const stepsLocal = [];
  let work = exprStr;

  // Helper to eval and display an operation by regex match and replacement
  const applyOpRegex = (regex, descFormatter)=>{
    let m;
    while((m = work.match(regex))){
      const matched = m[0];
      // compute value
      const val = evaluateSafe(matched);
      const valStr = (val===null) ? 'Error' : String(val);
      // push step: either compact or verbose
      if(compactMode) stepsLocal.push(`${matched} â†’ ${valStr}`);
      else stepsLocal.push(`${descFormatter(matched, valStr)}`);
      // replace first occurrence
      work = work.replace(matched, valStr);
    }
  };

  try {
    // 1. Exponentiation ** (right-associative) - match numbers/expressions with **
    // Regex approximates segments like 2**3 or 2.5**(3) or Math.pow(2,3)
    applyOpRegex(/(?:[0-9.()]+|Math\.[A-Za-z0-9_]+\([^\)]*\))\s*\*\*\s*(?:[0-9.()]+|Math\.[A-Za-z0-9_]+\([^\)]*\))/g,
      (m,v)=> (lang==='en') ? `Evaluate power ${m} = ${v}` : `Okwalaba obusobeko ${m} = ${v}`);

    // 2. Multiplication/Division * or /
    applyOpRegex(/(?:[0-9.()]+|Math\.[A-Za-z0-9_]+\([^\)]*\))\s*[*/]\s*(?:[0-9.()]+|Math\.[A-Za-z0-9_]+\([^\)]*\))/g,
      (m,v)=> (lang==='en') ? `Evaluate multiply/divide ${m} = ${v}` : `Kukola okukozesa ${m} = ${v}`);

    // 3. Addition/Subtraction (note: handle unary minus is tricky; we match binary ops)
    applyOpRegex(/(?:[0-9.()]+|Math\.[A-Za-z0-9_]+\([^\)]*\))\s*[+-]\s*(?:[0-9.()]+|Math\.[A-Za-z0-9_]+\([^\)]*\))/g,
      (m,v)=> (lang==='en') ? `Evaluate add/subtract ${m} = ${v}` : `Kugatta oba okukyusa ${m} = ${v}`);
  } catch(e){
    stepsLocal.push((lang==='en') ? 'Cannot compute further breakdown.' : "Tosobola okukakasa enziza z'okukola.");
  }

  // If nothing changed (no matches), but we can try a final evaluate
  if(stepsLocal.length===0){
    try{
      const final = evaluateSafe(work);
      stepsLocal.push((compactMode) ? `${work} â†’ ${final}` : ((lang==='en') ? `Evaluate ${work} = ${final}` : `Kukola ${work} = ${final}`));
      work = String(final);
    } catch(e){
      stepsLocal.push((lang==='en') ? 'Cannot break down expression further.' : 'Tosobola kukola enkyusa.');
    }
  } else {
    // After applying ops, there might be new simplifications possible; recursively continue until numeric final
    // attempt a few passes
    for(let pass=0; pass<6; pass++){
      // try exponents again, mult/div, add/sub until no changes
      let prev = work;
      // replace Math.func(...) occurrences by evaluating them if possible
      // evaluate any remaining Math.* function calls without parentheses (like Math.PI) are already replaced
      // attempt to evaluate any simple segment now:
      try {
        const maybe = evaluateSafe(work);
        if(maybe !== null && (typeof maybe === 'number' || typeof maybe === 'string')){
          stepsLocal.push((compactMode) ? `${work} â†’ ${maybe}` : ((lang==='en') ? `Evaluate ${work} = ${maybe}` : `Kukola ${work} = ${maybe}`));
          work = String(maybe); break;
        }
      } catch(e){}
      if(prev===work) break;
    }
  }

  return stepsLocal;
}

/* -----------------------
   UI helpers & actions
   ----------------------- */
function refreshDisplay(){ exprLine.innerText = expr || '\u00A0'; valueLine.innerText = expr || '0'; updateMeta(); }
function clearAll(){ expr=''; refreshDisplay(); resExplain.innerText = translations[lang].noCalc; renderSteps([]); }
function deleteChar(){ expr = expr.slice(0,-1); refreshDisplay(); }
function insertToken(t){ expr += t; refreshDisplay(); }
function setValue(v){ expr = String(v); refreshDisplay(); }
function pushHistory(e,r,expl){ history.unshift({e,r,expl,ts:Date.now()}); if(history.length>80) history.pop(); renderHistory(); }
function renderHistory(){ historyList.innerHTML=''; if(history.length===0){ const d=document.createElement('div'); d.className='hist-item'; d.innerText=translations[lang].noCalc; historyList.appendChild(d); return;} history.forEach(h=>{ const el=document.createElement('div'); el.className='hist-item'; el.innerHTML=`<div style="flex:1;min-width:0"><div style="font-weight:700;color:#e6eef7;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${h.e}</div><div style="font-size:13px;color:var(--muted)">${h.expl}</div></div><div style="margin-left:10px;color:#9ff3ea;font-weight:800">${h.r}</div>`; el.onclick=()=>{ setValue(h.r); resExplain.innerText=h.expl; speak(`${translations[lang].resultLabel} ${h.r}. ${h.expl}`)}; historyList.appendChild(el);}); }
function renderSteps(steps){ stepsBox.innerHTML=''; if(!steps || steps.length===0){ const d=document.createElement('div'); d.className='step'; d.innerText = (lang==='en'?'No steps yet. Enter expression and press =':'Tewali entambula. Tandika ensonda obale ='); stepsBox.appendChild(d); return;} steps.forEach((s,i)=>{ const d=document.createElement('div'); d.className='step'; d.dataset.index=i; d.innerText = s.text; stepsBox.appendChild(d); }); }
/* highlight player */
let highlightTimer=null;
function playHighlights(speed=900){
  if(highlightTimer) { clearInterval(highlightTimer); highlightTimer=null; }
  const nodes = Array.from(stepsBox.querySelectorAll('.step'));
  if(nodes.length===0) return;
  let idx=0;
  nodes.forEach(n=> n.classList.remove('highlight'));
  highlightTimer = setInterval(()=>{
    nodes.forEach(n=> n.classList.remove('highlight'));
    if(idx >= nodes.length){ clearInterval(highlightTimer); highlightTimer=null; return; }
    nodes[idx].classList.add('highlight');
    // scroll into view if needed
    nodes[idx].scrollIntoView({behavior:'smooth', block:'center'});
    idx++;
  }, speed);
}

/* speech */
function speak(txt){ if(!('speechSynthesis' in window)) return; const u=new SpeechSynthesisUtterance(txt); u.lang = (lang==='en') ? 'en-GB' : 'en-UG'; u.rate=1; u.pitch=1; window.speechSynthesis.cancel(); window.speechSynthesis.speak(u); }

/* calculate */
function calculateNow(){
  try {
    const toEval = expr || String(lastAns || 0);
    const result = evaluateSafe(toEval);
    lastAns = result;
    const explanation = (lang==='en') ? `The expression ${toEval} equals ${result}.` : `Ensonda ${toEval} eweereza ku ${result}.`;
    resExplain.innerText = explanation;
    valueLine.innerText = String(result);
    pushHistory(toEval, result, explanation);
    const steps = generateSteps(toEval);
    renderSteps(steps);
    // play highlight animation
    playHighlights(850);
    speak(`${translations[lang].resultLabel} ${result}. ${explanation}`);
    expr = String(result);
    refreshDisplay();
  } catch(e){
    valueLine.innerText = 'Error';
    resExplain.innerText = (lang==='en') ? 'Invalid expression. Check input.' : 'Ensonda tewaliiyo. Laba byowandisizza.';
    renderSteps([{text: (lang==='en' ? 'Cannot evaluate expression: check syntax.' : 'Tosobola okunonyonnyola ensonda: leka obukugu.')}]);
    speak((lang==='en') ? 'Error. Invalid expression.' : 'Ensobi. Ensonda tewaliiyo.');
  }
}

/* memory */
function memClear(){ memory=0; updateMeta(); speak(`${translations[lang].mem} ${memory}`) }
function memRecall(){ setValue(memory); speak(`${translations[lang].mem} ${memory}`) }
function memPlus(){ try{ const v=evaluateSafe(expr||String(lastAns)); memory += Number(v)||0; updateMeta(); speak(`${translations[lang].mem} ${memory}`);}catch(e){speak('Error')} }
function memMinus(){ try{ const v=evaluateSafe(expr||String(lastAns)); memory -= Number(v)||0; updateMeta(); speak(`${translations[lang].mem} ${memory}`);}catch(e){speak('Error')} }

/* Wiring events */
document.getElementById('keys').addEventListener('click',(ev)=>{ const btn = ev.target.closest('button'); if(!btn) return; const ins = btn.dataset.insert; const action = btn.dataset.action; if(ins !== undefined){ insertToken(ins); return; } switch(action){ case 'clear': clearAll(); break; case 'del': deleteChar(); break; case 'mc': memClear(); break; case 'mr': memRecall(); break; case 'mplus': memPlus(); break; case 'mminus': memMinus(); break; case 'sq': insertToken('**2'); break; case 'cube': insertToken('**3'); break; case 'percent': insertToken('/100'); break; case 'ans': setValue(lastAns); break; case 'history': renderHistory(); break; case 'explain': { try{ const v=evaluateSafe(expr||String(lastAns)); const expl = (lang==='en') ? `The expression ${expr||lastAns} equals ${v}.` : `Ensonda ${expr||lastAns} eweereza ku ${v}.`; resExplain.innerText=expl; speak(expl); const steps = generateSteps(expr||String(lastAns)); renderSteps(steps); playHighlights(900);}catch(e){ resExplain.innerText=(lang==='en'?'Cannot explain invalid expression.':'Tosobola okunnyonnyola.'); speak('Cannot explain'); } } break; case 'neg': insertToken('*-1'); break; default: break; } });

document.getElementById('equalBtn').addEventListener('click', calculateNow);

window.addEventListener('keydown',(e)=>{ if(e.key >= '0' && e.key <= '9'){ insertToken(e.key); return; } if(e.key === '.') { insertToken('.'); return; } if(['+','-','*','/','(',')'].includes(e.key)){ insertToken(e.key); return; } if(e.key === 'Enter'){ e.preventDefault(); calculateNow(); return; } if(e.key === 'Backspace'){ deleteChar(); return; } });

/* switches */
document.getElementById('langBtn').addEventListener('click', ()=>{ lang = (lang==='en') ? 'lg' : 'en'; document.getElementById('langBtn').innerText = translations[lang].langShort; titleEl.innerText = translations[lang].title; histTitle.innerText = translations[lang].history; stepsTitle.innerText = translations[lang].stepsTitle; resLabel.innerText = translations[lang].resultLabel; resExplain.innerText = translations[lang].noCalc; renderSteps([]); renderHistory(); updateMeta(); });

document.getElementById('designBtn').addEventListener('click', ()=>{ design = (design==='realistic') ? 'digital' : 'realistic'; const calc=document.getElementById('calc'); if(design==='realistic'){ calc.classList.remove('digital'); calc.classList.add('realistic'); document.getElementById('designBtn').classList.add('active'); document.getElementById('designBtn').innerText = translations[lang].modeReal; } else { calc.classList.remove('realistic'); calc.classList.add('digital'); document.getElementById('designBtn').classList.remove('active'); document.getElementById('designBtn').innerText = translations[lang].modeDig; } updateMeta(); });

document.getElementById('themeBtn').addEventListener('click', ()=>{ theme = (theme==='dark') ? 'light' : 'dark'; if(theme==='light'){ document.body.style.background = 'linear-gradient(180deg,#f8fafc,#eef2ff)'; document.body.style.color = '#071022'; document.getElementById('themeBtn').classList.add('active'); document.getElementById('themeBtn').innerText = translations[lang].themeLight; } else { document.body.style.background = 'linear-gradient(180deg,var(--bg1),var(--bg2))'; document.body.style.color = '#e6eef7'; document.getElementById('themeBtn').classList.remove('active'); document.getElementById('themeBtn').innerText = translations[lang].themeDark; } updateMeta(); });

compactBtn.addEventListener('click', ()=>{ compactMode = !compactMode; compactBtn.innerText = compactMode ? translations[lang].compact : translations[lang].verbose; compactBtn.classList.toggle('active'); renderSteps([]); });

/* meta & init */
function updateMeta(){ meta.innerText = `${translations[lang].mem} ${memory} â€¢ Mode: ${design==='realistic'?translations[lang].modeReal:translations[lang].modeDig} â€¢ Language: ${lang==='en'?'English':'Luganda'}`; }
updateMeta(); refreshDisplay(); renderHistory(); renderSteps([]);
setTimeout(()=>{ speak(translations[lang].title); },600);
</script>
</body>
</html>
